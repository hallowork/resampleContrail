# HDF文件瘦身处理程序总结

## 程序概述

这个程序专门用于处理HDF文件，只保留经纬度数据（'Latitude'和'Longitude'），删除其他所有参数，从而达到瘦身的目的。

## 主要功能

### 1. 并行处理
- 支持多worker并行处理，提高处理速度
- 默认使用5个worker，可通过参数调整
- 使用Python的multiprocessing模块实现

### 2. 文件格式支持
- **HDF5格式**: 使用h5py库处理
- **HDF4格式**: 使用pyhdf库处理
- 自动检测文件格式并选择合适的处理方法

### 3. 文件瘦身
- 只保留经纬度数据，删除其他所有参数
- 保持原始文件名不变
- 大幅减少文件大小（通常可达到70-80%的瘦身效率）

### 4. 详细日志
- 记录处理过程和结果统计
- 显示每个文件的处理结果和瘦身效率
- 保存到log.txt文件中

### 5. 错误处理
- 对处理失败的文件进行记录，不影响其他文件处理
- 提供详细的错误信息
- 确保程序的健壮性

## 文件说明

### 核心文件
- `hdf_processor.py`: 核心处理模块，包含所有处理逻辑
- `main.py`: 主程序，提供命令行接口
- `demo.py`: 演示程序，使用模拟数据展示功能

### 测试工具
- `test_hdf_files.py`: HDF文件测试工具，检查文件格式和内容
- `simple_test.py`: 简单测试工具，测试单个文件处理

### 配置文件
- `requirements.txt`: 依赖包列表
- `README.md`: 详细使用说明
- `SUMMARY.md`: 本总结文档

## 使用方法

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 基本使用
```bash
python main.py
```

### 3. 自定义参数
```bash
python main.py --input-folder "D:\MyData" --workers 8
```

### 4. 演示功能
```bash
python demo.py
```

## 参数配置

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `--input-folder` | `C:\Users\wuch\Documents` | 输入文件夹路径 |
| `--workers` | `5` | 并行处理的worker数量 |
| `--log-file` | `log.txt` | 日志文件名 |

## 输出结果

程序会输出以下信息：

1. **处理统计**:
   - 总文件数
   - 成功处理文件数
   - 处理失败文件数

2. **大小统计**:
   - 原始总大小（MB）
   - 缩减后总大小（MB）
   - 总体瘦身效率（%）

3. **详细日志**:
   - 每个文件的处理结果
   - 处理时间
   - 错误信息（如果有）

## 示例输出

```
============================================================
处理完成！
============================================================
总文件数: 5
成功处理: 5 个文件
处理失败: 0 个文件
原始总大小: 190.77 MB
缩减后总大小: 38.16 MB
总体瘦身效率: 80.0%
处理时间: 0:00:00.186320
详细日志: log.txt
```

## 技术特点

### 1. 内存管理
- 使用临时文件处理，避免内存溢出
- 及时释放文件句柄
- 支持大文件处理

### 2. 错误恢复
- 单个文件失败不影响整体处理
- 详细的错误日志记录
- 支持断点续传（重新运行即可）

### 3. 性能优化
- 并行处理提高效率
- 优化的文件读写操作
- 最小化磁盘I/O

## 注意事项

1. **备份重要数据**: 程序会直接修改原文件，建议先备份
2. **文件权限**: 确保对输入文件夹有读写权限
3. **磁盘空间**: 处理过程中需要临时空间
4. **文件格式**: 确保HDF文件包含经纬度数据

## 依赖包

- `h5py>=3.8.0`: HDF5文件处理
- `numpy>=1.19.0`: 数值计算
- `pyhdf>=0.10.0`: HDF4文件处理

## 系统要求

- Python 3.6+
- Windows/Linux/macOS
- 足够的磁盘空间
- 支持的文件格式：.hdf, .HDF, .h5, .H5

## 故障排除

### 常见问题

1. **"file signature not found"**: 文件格式不支持或文件损坏
2. **"Read error"**: 文件权限问题或文件损坏
3. **"attribute not found"**: HDF文件结构特殊，某些属性缺失

### 解决方案

1. 使用`test_hdf_files.py`检查文件格式
2. 确保文件权限正确
3. 尝试使用演示程序验证功能
4. 检查日志文件获取详细错误信息

## 更新日志

- v1.0: 初始版本，支持HDF5和HDF4格式
- 添加并行处理功能
- 添加演示程序
- 完善错误处理和日志记录
